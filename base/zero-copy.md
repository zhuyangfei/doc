# zero copy
zero-copy用来减少IO操作中，数据拷贝的次数，以优化IO的性能。
使用传统IO，从一个文件读取数据，然后，讲数据写到网络或者磁盘。数据需要经过4次的内存拷贝及4次的内核-用户空间切换，即：
read：调用，从用户空间-》内核空间。返回，内核空间-》用户空间。
通过DMA，数据从磁盘缓冲区拷贝到内核缓冲区，然后，内核缓冲区-》用户缓冲区，
write：调用，从用户空间-》内核空间。返回，内核空间-》用户空间。
数据，从用户缓冲区拷贝到内核缓冲区，再通过DMA，由内核缓冲区-》磁盘缓冲区。

## zero-copy技术
1. `mmp + write`: 将内核空间直接映射到用户空间，减少一次read过程，内核缓冲区到用户缓冲区的拷贝，因此，省了一次拷贝。
2. `sendfile`：`目的fd`的内核buffer，从`源fd`的内核buffer拷贝数据，数据不再拷贝到用户空间，因此，省了一次拷贝，同时，减少两次内核空间-用户空间的切换。
3. `sendfile + DMA`：`目的fd`，直接`源fd`的内核空间读数据，然后，通过DMA，直接到硬件缓冲区。少了2次拷贝。
4. `splice`：`目的fd`的内核buffer与`源fd`的内核buffer之间建立管道，也避免了内核缓冲区之间的拷贝。少了2次拷贝。
详见：https://zhuanlan.zhihu.com/p/83398714

## 适用场景
数据在整个操作过程没有修改，如：从读取文件数据，然后，将数据发送到网络。

## 产品
使用zero-copy的产品有，DPDK，ZMQ，libevent等，详见：https://chat.openai.com/c/1909321d-caad-4378-96d0-cc46e5d9e560
